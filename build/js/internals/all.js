!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=19)}([function(e,t){e.exports={LOCAL_STORAGE_DATA_KEY:"YACEP_EMO_DATA",LOCAL_STORAGE_INFO_KEY:"YACEP_EMO_INFO",LOCAL_STORAGE_GROUP_MENTION:"CHATPP_GROUP_MENTION",LOCAL_STORAGE_ROOM_SHORTCUT:"CHATPP_ROOM_SHORTCUT",LOCAL_STORAGE_DISABLE_NOTIFY_ROOM:"CHATPP_DISABLE_NOTIFY_ROOM",CHROME_LOCAL_KEY:"CHATPP_CHROME_LOCAL_DATA",CHROME_SYNC_KEY:"CHATPP_CHROME_SYNC_DATA",CHROME_SYNC_GROUP_KEY:"CHATPP_CHROME_SYNC_GROUP",CHROME_SYNC_ROOM_KEY:"CHATPP_CHROME_SYNC_ROOM",CHROME_SYNC_DISABLE_NOTIFY_ROOM_KEY:"CHATPP_CHROME_SYNC_DISABLE_NOTIFY_ROOM",DEFAULT_DATA_URL:"https://dl.dropboxusercontent.com/s/lmxis68cfh4v1ho/default.json?dl=1",ADVERTISEMENT_URL:"https://dl.dropboxusercontent.com/s/jsmceot0pqi8lpk/chatppad.json?dl=1",VERSION_CHROME:"VERSION_CHROME",VERSION_FIREFOX:"VERSION_FIREFOX",VERSION_NAME_DEV:"dev",VERSION_NAME_RELEASE:"final",DEFAULT_IMG_HOST:"https://chatpp.thangtd.com/",DELAY_TIME:6e3,FORCE_TURN_OFF_THUMBNAIL:1,ADVERTISEMENT_LOAD_TIMEOUT:18e5,TO_ALL_MARK:"TO ALL >>>"}},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(0),r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=i.VERSION_CHROME,this.app_detail=this.getAppDetail(),this.official_emoticons_data={Default:{name:"Default",link:"https://dl.dropboxusercontent.com/s/lmxis68cfh4v1ho/default.json?dl=1",description:"The default Emoticons data of Chat++"},Vietnamese:{name:"Vietnamese",link:"https://dl.dropboxusercontent.com/s/2b085bilbno4ri1/vietnamese.json?dl=1",description:"Yet another data for people who want to use Vietnamese Emoticons"},Japanese:{name:"Japanese",link:"https://dl.dropboxusercontent.com/s/fdq05pwwtsccrn6/japanese.json?dl=1",description:"Yet another data for people who want to use Japanese Emoticons"},Skype:{name:"Skype",link:"https://dl.dropboxusercontent.com/s/8ew2mdh0v2vcad8/skype.json?dl=1",description:"Skype Original Emoticons"}}}return o(e,[{key:"isChromeVersion",value:function(){return this.version===i.VERSION_CHROME}},{key:"isFirefoxVersion",value:function(){return this.version===i.VERSION_FIREFOX}},{key:"isDevVersion",value:function(){var e=this.app_detail.name;return-1!==e.indexOf(i.VERSION_NAME_DEV,e.length-i.VERSION_NAME_DEV.length)}},{key:"checkDevVersionInternal",value:function(){return localStorage.chatpp_version_name===i.VERSION_NAME_DEV}},{key:"getStorage",value:function(e){return!e&&this.isChromeVersion()?chrome.storage.sync:chrome.storage.local}},{key:"sync",value:function(e,t,n){var o={};o[e]=t,this.getStorage().set(o,function(){n&&n()})}},{key:"getEmoticonDataUrl",value:function(e,t){return e&&this.official_emoticons_data[e]&&(t=this.official_emoticons_data[e].link),t?t.replace("http://i.imgur.com/","https://i.imgur.com/"):null}},{key:"getObjectLength",value:function(e){return Object.keys(e).length}},{key:"htmlEncode",value:function(e){return $("<div/>").text(e).html()}},{key:"getEmoUrl",value:function(e){var t=i.DEFAULT_IMG_HOST+"img/emoticons/"+e;return 0!=e.indexOf("https://")&&0!=e.indexOf("http://")||(t=e),this.htmlEncode(t)}},{key:"parseRoomId",value:function(e){var t=e.match(/\d+/g);if(!t||0==t.length)return null;t=t[0];return/^[0-9]{6,10}$/g.test(t)?t:null}},{key:"reload",value:function(){location.reload()}},{key:"getAppDetail",value:function(){return chrome.app.getDetails()}},{key:"getAppVersion",value:function(){return this.app_detail.version}},{key:"getAppVersionName",value:function(){return this.isDevVersion()?i.VERSION_NAME_DEV:i.VERSION_NAME_RELEASE}},{key:"getAppFullName",value:function(){var e=this.getAppVersionName();return this.app_detail.short_name+" "+this.app_detail.version+" "+e}},{key:"openNewUrl",value:function(e){chrome.tabs.create({url:e})}},{key:"getExtensionPageUrl",value:function(e){return chrome.extension.getURL(e)}},{key:"openNewExtensionPageUrl",value:function(e){this.openNewUrl(this.getExtensionPageUrl(e))}},{key:"validateUrl",value:function(e){return/(https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}},{key:"validateDropboxUrl",value:function(e){if(!this.validateUrl(e))return!1;var t=!0,n=!1,o=void 0;try{for(var i,r=["https://dl.dropboxusercontent.com/","https://www.dropbox.com/"][Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;if(e.startsWith(a))return!0}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}return!1}},{key:"isPage",value:function(e){return $("#page-name").data("page-name")===e}},{key:"setPageTitle",value:function(){$("#chatpp_name").html(this.getAppFullName())}},{key:"setStatus",value:function(e,t){-1===e.indexOf("_status")&&(e+="_status"),localStorage[e]=!!t}},{key:"getStatus",value:function(e){return-1===e.indexOf("_status")&&(e+="_status"),"true"===localStorage[e]||!0===localStorage[e]}},{key:"regexEscape",value:function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}},{key:"generateEmoticonRegex",value:function(e,t){return t=t||this.htmlEncode(this.regexEscape(e)),new RegExp(t,"g")}},{key:"random",value:function(e){return e.length?e[Math.floor(Math.random()*e.length)]:null}},{key:"randomString",value:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}}]),e}());e.exports=r},,,,function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(1),r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"myId",value:function(){return AC.myid}},{key:"getUserName",value:function(e){return AC.getDefaultNickName(e)}},{key:"currentRoom",value:function(){return RM.id}},{key:"getRoomAdmins",value:function(){var e=this.getRoomMembers(),t=[];for(var n in e)"admin"===e[n]&&t.push(n);return t}},{key:"isAdmin",value:function(e){return"admin"===this.getRoomMembers()[e=e||this.myId()]}},{key:"getRoomMembers",value:function(){return RM.member_dat}},{key:"getRoomMembersCount",value:function(){return RM.sorted_member_list.length}},{key:"getRoomMembersArray",value:function(){var e=this.getRoomMembers();return Object.keys(e)}},{key:"getRandomMemberInRoom",value:function(){var e=this.getRoomMembersArray();return i.random(e)}},{key:"searchRoomsByPerson",value:function(e){var t=RL.rooms,n=[];for(var o in t){var i=t[o];i._name&&i.member_dat&&i.member_dat.hasOwnProperty(e)&&n.push(i)}return n}},{key:"removeMemberFromRoom",value:function(e,t){var n=RL.rooms[t];if("group"===n.type&&n.member_dat.hasOwnProperty(e)&&"admin"===n.member_dat[this.myId()]){if(!window.confirm("Are you sure to delete this user from "+n.getName()+" ?"))return!1;delete n.member_dat[e];var o={body_params:{cmd:"update_room",room_id:t,role:n.member_dat},query_params:{}};return CW.post("gateway.php",o),!0}return!1}},{key:"getChatText",value:function(){return $("#_chatText").val()}},{key:"clearChatText",value:function(){CS.view.setChatText("")}},{key:"checkNotifyAllCondition",value:function(){return i.checkDevVersionInternal()||this.getRoomMembersCount()>100&&this.isAdmin()}}]),e}());e.exports=r},,,,,,,,,,,,,,function(e,t,n){e.exports=n(20)},function(e,t,n){var o=n(21),i=n(22),r=n(23),a=n(24),s=n(25),c=n(26),l=n(27),u=n(28),h=void 0;$(function(){var e=!1;h=setInterval(function(){"undefined"!=typeof CW&&"undefined"!=typeof RM&&(window.clearInterval(h),$("#_chatppPreLoad").remove(),$('<style type="text/css"> .emoticonTextEnable{font-weight: bold;};</style>').appendTo("head"),$('<style type="text/css"> .chatppErrorsText{font-weight: bold; color: red;};</style>').appendTo("head"),$('<style type="text/css"> .chatInput__element{opacity: 0.8;display: inline-block;padding: 0 5px;cursor: pointer;};</style>').appendTo("head"),$('<style type="text/css"> .messageBadge{vertical-align: middle !important;};</style>').appendTo("head"),$('<style type="text/css"> .timelineLinkTrim{vertical-align: middle !important;};</style>').appendTo("head"),$("<style type=\"text/css\"> img.ui_emoticon:not([src^='https://assets.chatwork']) {width: auto !important;height: auto !important;}</style>").appendTo("head"),o.status&&(e=!0,o.setUp(),r.updateChatworkView()),u.setUp(),i.setUp(),a.setUp(),s.setUp(),r.updateChatSendView(),r.updateGetContactPanelView(),RoomView.prototype.buildOld=RoomView.prototype.build,RoomView.prototype.build=function(e){this.buildOld(e),window.chatpp_id!=RM.id&&(window.chatpp_id=RM.id,setTimeout(function(){o.addExternalEmoList(!1),l.setUp(),c.setUp()},100))},e&&RL.rooms[RM.id].build())},100)})},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(1),r=n(0),a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.status=i.getStatus("emoticon"),this.emoticons=[],this.start=/::/gi,this.is_colon=!1,this.emo_name="",this.emo_cursor_loca=0,this.list_all_emo=JSON.parse(localStorage[r.LOCAL_STORAGE_DATA_KEY]),this.chat_text_jquery=$("#_chatText"),this.chat_text_element=document.getElementById("_chatText")}return o(e,[{key:"setUp",value:function(){var e=this;if(this.status){this.emoticons=JSON.parse(localStorage[r.LOCAL_STORAGE_DATA_KEY]),this.sorted_emoticons=this.emoticons.slice().sort(function(e,t){return e.priority<t.priority?1:e.priority>t.priority?-1:e.key<t.key?-1:e.key>t.key?1:0});$("#_chatTextArea").append("<div id='suggestion-emotion-container'></div>"),$("#suggestion-emotion-container").css({background:"#fff",position:"absolute","max-height":"200px",width:"200px",border:"1px solid #ababab","border-radius":"3px",padding:"4px 6px 4px 6px","box-shadow":"0px 3px 10px rgba(103, 103, 103, 0.57)",display:"none","overflow-y":"auto","z-index":"99"}),this.chat_text_jquery.click(function(){return e.hideSuggestionEmotionsBox()}),$("#_roomListArea").click(function(){return e.hideSuggestionEmotionsBox()}),$("#_headerSearch").click(function(){return e.hideSuggestionEmotionsBox()}),this.addExternalEmoList(!0),this.addExternalEmo(),this.setEmoticonTextLabel(),$(document).keyup(function(t){e.status&&27==t.which&&e.hideSuggestionEmotionsBox()}),this.chat_text_jquery.keydown(function(t){40==t.which&&e.is_colon&&(e.emo_cursor_loca!=$("#suggestion-emotion-container").find("p").length-1&&(e.emo_cursor_loca+=1),t.preventDefault()),38==t.which&&e.is_colon&&(-1!==e.emo_cursor_loca&&(e.emo_cursor_loca-=1),t.preventDefault()),13!=t.which&&9!=t.which||!e.is_colon||($("#suggestion-emotion-container").find("p[data-emo-selected='true']").click(),t.preventDefault())}),$("#suggestion-emotion-container").on("mouseenter","p",function(e){$(e.currentTarget).attr("data-emo-selected",!0),$(e.currentTarget).css("background-color","rgb(216, 240, 249)")}).on("mouseleave","p",function(e){$(e.currentTarget).removeAttr("data-emo-selected"),$(e.currentTarget).css("background-color","#fff")}).on("click","p",function(t){var n=e.chat_text_jquery.val().lastIndexOf("::"+e.emo_name),o=e.chat_text_jquery.val().slice(e.emo_name.length+n+2,e.chat_text_jquery.val().length),i=e.chat_text_jquery.val().substring(0,n)+$(t.currentTarget).attr("data-emo")+" "+o;$("#_chatText").val(i),e.hideSuggestionEmotionsBox(),$("#_chatText").focus()}),this.chat_text_jquery.keyup(function(t){if(e.chat_text_jquery.val()||e.hideSuggestionEmotionsBox(),-1!=e.getNearestAtmarkIndex()?e.is_colon=!0:e.is_colon=!1,40==t.which&&e.is_colon){var n=$("#suggestion-emotion-container").scrollTop(),o=$(".suggestion-emo-list[data-emo-selected='true']").height();$("#suggestion-emotion-container").scrollTop(o+n);var r=$("#suggestion-emotion-container").find("p");$(r[e.emo_cursor_loca]).length>0&&($(r[e.emo_cursor_loca-1]).mouseleave(),$(r[e.emo_cursor_loca]).mouseenter())}else{if(38==t.which&&e.is_colon){var a=$("#suggestion-emotion-container").scrollTop(),s=$(".suggestion-emo-list[data-emo-selected='true']").height();$("#suggestion-emotion-container").scrollTop(a-s);var c=$("#suggestion-emotion-container").find("p");return-1==e.emo_cursor_loca?void $(c).mouseleave():void($(c[e.emo_cursor_loca]).length>0&&($(c[e.emo_cursor_loca+1]).mouseleave(),$(c[e.emo_cursor_loca]).mouseenter()))}if(8==t.which)if(e.emo_name.length>0){var l=e.emo_name.split("");l.pop(),e.emo_name=l.join("")}else e.hideSuggestionEmotionsBox();if(32==t.which&&e.hideSuggestionEmotionsBox(),e.is_colon){e.emo_name.length>0&&($("#suggestion-emotion-container").html(""),$("#suggestion-emotion-container").fadeIn(0));var u=e.chat_text_jquery.val().lastIndexOf("::"),h=e.chat_text_jquery.val().substr(u+2),d="";(d=h.match(/\n/)?h.split(/\r|\n/):h.split(" ")).length>0?37==t.which&&38==t.which&&39==t.which&&40==t.which||(e.emo_name=d[0]):e.hideSuggestionEmotionsBox();var m=$.grep(e.list_all_emo,function(t){return t.key.toLowerCase().indexOf(e.emo_name)>-1}),g="";if(m.length>0){for(var p=0;p<m.length;p++)g+=0==p?'<p class="suggestion-emo-list" data-emo-selected="true" data-emo="'+m[p].key+'" style="cursor: pointer; margin-top: 5px; background-color: rgb(216, 240, 249);">':'<p class="suggestion-emo-list" data-emo="'+m[p].key+'" style="cursor: pointer; margin-top: 5px;">',g+='<img id="example" src="'+i.htmlEncode(i.getEmoUrl(m[p].src))+'" title="'+m[p].key+" - "+m[p].data_name+' - Chatpp" alt="'+m[p].key+'" style="width: 100%; max-width: 50px;"> <b> '+m[p].key+"</b></p>";$("#suggestion-emotion-container").append(g)}else $("#suggestion-emotion-container").html(""),$("#suggestion-emotion-container").fadeOut(0);var _=e.chat_text_element.getBoundingClientRect(),f=Measurement.caretPos(e.chat_text_jquery);f.left-=_.left;var v=window.innerHeight-f.top;$("#_chatTextArea").css({"overflow-y":"visible","z-index":0}),$("#suggestion-emotion-container").parent().css({position:"relative"}),$("#suggestion-emotion-container").css({bottom:v,left:f.left+5})}}})}}},{key:"getNearestAtmarkIndex",value:function(){var e=this.chat_text_jquery.val();if(!e.match(this.start))return-1;var t=this.doGetCaretPosition(this.chat_text_element),n=e.indexOf("::"),o=-1;do{if(n>=t)break;o=n,n=e.indexOf("::",n+1)}while(-1!=n);return o}},{key:"doGetCaretPosition",value:function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}},{key:"addExternalEmoList",value:function(e){if(this.status&&!($("#externalEmoticonsButton").length>0)&&($("#_chatSendTool").append($("<li>",{id:"_externalEmoticonsButton",class:"_showDescription chatInput__element",css:{display:"inline-block"},attr:{role:"button"}}).append($("<span>",{id:"externalEmoticonsButton",class:"icoFontActionMore icoSizeLarge"}))),e)){$("#_wrapper").append($("<style>").append("::-webkit-scrollbar {width:10px;height:10px} .w3-emotion {display:inline-block;text-align:center;min-width:80px;height:30px;border:1px solid #ccc;cursor:pointer;margin:0px 2px;border-radius:5px;font-size:10px;background-color:white;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")),$("#_wrapper").append($("<div>",{id:"_externalEmoticonList",class:"emoticonList emoticonTooltip toolTip tooltip--white mainContetTooltip",css:{opacity:"1","z-index":"2",display:"none",top:"480px",left:"160px",role:"tooltip",width:"350px"}}).append($("<div>",{class:"_cwTTTriangle toolTipTriangle toolTipTriangleWhiteBottom",css:{left:"129px"}}),$("<ul>",{id:"_emoticonGalleryTab",css:{display:"flex","flex-wrap":"wrap","justify-content":"center","max-width":"350px",height:"450px",overflow:"auto"}}),$("<div>",{id:"_externalEmotionDescription",class:"tooltipFooter"}),$("<div>",{id:"tabEmotionBig",css:{display:"flex",overflow:"auto","overflow-y":"scroll",height:"42px"}})));var t=_is_mac?L.chatsend_shift_and_command_hint:L.chatsend_shift_and_ctrl_hint,n=$("#_externalEmoticonList").cwToolTip({open:function(){return $("#_externalEmotionDescription").text(t)}}),o=[],r=this.sorted_emoticons;r.forEach(function(e){-1==o.indexOf(e.data_name)&&o.push(e.data_name)});var a=[],s=[];o.forEach(function(e){a=[],r.map(function(t){var n=i.htmlEncode(t.key),o=n+" - "+t.data_name+" - Chatpp",r=i.htmlEncode(i.getEmoUrl(t.src));if(t.data_name==e){var s=$("<li>",{css:{padding:"5px",cursor:"pointer",border:"1px solid #fff","border-radius":"3px",transition:"border 0.2s linear 0s"}}).append($("<img>",{id:"example",css:{width:"100%","max-width":"50px"},attr:{src:r,title:o,alt:n}}));return a.push(s),s.prop("outerHTML")}}).join(""),s.push(a)}),$("body").on("click","#externalEmoticonsButton",function(e){n.open($(e.currentTarget)),$("#_emoticonGalleryTab li").remove(),$("#_externalEmoticonList #_emoticonGalleryTab").append(s[0]),$("#_externalEmoticonList #tabEmotionBig button").css("background-color","white"),$("#tabEmotion0").css("background-color","#eaeae8")}),o.forEach(function(e,t){$("#_externalEmoticonList #tabEmotionBig").append($("<button>",{id:"tabEmotion"+t,class:"w3-bar-item w3-button w3-emotion"}).append(e))}),o.forEach(function(e,t){$("#tabEmotion"+t).on("click",function(e){e.preventDefault(),$("#_emoticonGalleryTab li").remove(),$("#_externalEmoticonList #_emoticonGalleryTab").append(s[t])})}),o.forEach(function(e,t){$("#_externalEmoticonList #tabEmotionBig button").on("click",function(e){$("#_externalEmoticonList #tabEmotionBig button").css("background-color","white"),$(e.currentTarget).css("background-color","#eaeae8")}),$("#_externalEmoticonList #tabEmotionBig #tabEmotion"+t).hover(function(t){$(t.currentTarget).attr("data-toggle","tooltip"),$(t.currentTarget).attr("data-placement","top"),$(t.currentTarget).attr("title",e)})}),$("#_externalEmoticonList").on("mouseenter","li",function(e){var t=$(e.currentTarget).find("img");$("#_externalEmotionDescription").text(t.attr("title"))}).on("mouseleave","li",function(){return $("#_externalEmotionDescription").text(t)}).on("click","li",function(){CW.view.key.ctrl||CW.view.key.command?(n.close(),CS.view.sendMessage($(this).find("img").prop("alt"),!0)):($("_chatText").focus(),CS.view.setChatText($(this).find("img").prop("alt"),!0),CW.view.key.shift||n.close())})}}},{key:"addExternalEmo",value:function(){this.addEmo(this.emoticons),this.status=!0}},{key:"isSpecialEmo",value:function(e){return[":-ss",":-??","~:>",":@)","~X(","3:-O"].indexOf(e)>-1}},{key:"setEmoticonTextLabel",value:function(){$("#_externalEmoticonsButton").attr("aria-label","View Chat++ Emoticons")}},{key:"addEmo",value:function(e){for(var t=0;t<e.length;t++){var n=i.htmlEncode(e[t].key),o=n+" - "+e[t].data_name+" - Chatpp",r=i.htmlEncode(i.getEmoUrl(e[t].src));if(this.isNewMechanism()){var a={name:n,title:o,src:r,tag:e[t].key,external:!0};emoticons.baseEmoticons.push(a),emoticons.tagHash[e[t].key]=a}else{this.isSpecialEmo(e[t].key)&&(o="",n="");var s='<img src="'+r+'" title="'+o+'" alt="'+n+'" class="ui_emoticon"/>',c=i.generateEmoticonRegex(e[t].key,e[t].regex);CW.reg_cmp.push({key:c,rep:s,reptxt:e[t].key,external:!0})}}this.isNewMechanism()&&tokenizer.setEmoticons(emoticons.getAllEmoticons().map(function(e){return e.tag}))}},{key:"isNewMechanism",value:function(){return"undefined"!=typeof emoticons&&"undefined"!=typeof tokenizer}},{key:"hideSuggestionEmotionsBox",value:function(){this.is_colon=!1,this.emo_name="",this.emo_cursor_loca=0,$("#suggestion-emotion-container").scrollTop(0),$("#suggestion-emotion-container").fadeOut(0),$("#suggestion-emotion-container").html("")}}]),e}());e.exports=a},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(0),r=n(1),a=32,s=65,c=66,l=69,u=74,h=75,d=76,m=77,g=78,p=81,_=82,f=83,v=84,y=86,x=88,b=90,T=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.shortcuts_default={reply:_,quote:p,link:d,edit:l,task:v,my_chat:s,scroll:f,previous_mention:h,next_mention:u,next_mention_room:m,next_new_message_room:g,down_room:y,up_room:c,first_room:b,first_nonstick_room:x,focus_chatbox:a,edit_image_upload:l},this.room_shortcuts={},localStorage[i.LOCAL_STORAGE_ROOM_SHORTCUT]&&(this.room_shortcuts=JSON.parse(localStorage[i.LOCAL_STORAGE_ROOM_SHORTCUT])),this.status=r.getStatus("shortcut")}return o(e,[{key:"setUp",value:function(){this.status&&this.registerShortcut()}},{key:"registerShortcut",value:function(){var e=this,t=this.shortcuts_default;for(var n in CW.view.registerKeyboardShortcut(t.reply,!1,!1,!1,!1,function(){var t=e.getHoverMessageId();e.replyMessage(t)}),CW.view.registerKeyboardShortcut(t.quote,!1,!1,!1,!1,function(){e.triggerDefaultAction("quote")}),CW.view.registerKeyboardShortcut(t.link,!1,!1,!1,!1,function(){e.triggerDefaultAction("link")}),CW.view.registerKeyboardShortcut(t.edit,!1,!1,!1,!1,function(){e.triggerDefaultAction("edit")}),CW.view.registerKeyboardShortcut(t.task,!1,!1,!1,!1,function(){e.triggerDefaultAction("task")}),CW.view.registerKeyboardShortcut(t.my_chat,!1,!1,!1,!1,function(){RL.selectRoom(AC.getRoomId(AC.myid))}),CW.view.registerKeyboardShortcut(t.scroll,!1,!1,!1,!1,function(){e.goToBottom()}),CW.view.registerKeyboardShortcut(t.previous_mention,!1,!1,!1,!1,function(){e.goToPreviousMention()}),CW.view.registerKeyboardShortcut(t.next_mention,!1,!1,!1,!1,function(){e.goToNexMention()}),CW.view.registerKeyboardShortcut(t.next_mention_room,!1,!1,!1,!1,function(){e.nextUnreadRoom(!0)}),CW.view.registerKeyboardShortcut(t.next_new_message_room,!1,!1,!1,!1,function(){e.nextUnreadRoom()}),CW.view.registerKeyboardShortcut(t.up_room,!1,!1,!1,!1,function(){e.nextRoom(!0)}),CW.view.registerKeyboardShortcut(t.down_room,!1,!1,!1,!1,function(){e.nextRoom()}),CW.view.registerKeyboardShortcut(t.first_room,!1,!1,!1,!1,function(){e.firstRoom()}),CW.view.registerKeyboardShortcut(t.first_nonstick_room,!1,!1,!1,!1,function(){e.firstRoom(!0)}),CW.view.registerKeyboardShortcut(t.focus_chatbox,!1,!1,!1,!1,function(){$("#_chatText").focus()}),CW.view.registerKeyboardShortcut(t.edit_image_upload,!1,!0,!1,!1,function(){e.triggerDefaultAction("edit");var t=$("#_chatText"),n=t.val(),o=n.match(/(\[preview id=[0-9]* ht=[0-9]*\])/);o&&o[0]&&(n=n.replace(/\[info\].*\[\/info\]/,o[0]),t.val(n))}),this.room_shortcuts)this.room_shortcuts[n]&&this.room_shortcuts.hasOwnProperty(n)&&function(){var t=e.room_shortcuts[n];CW.view.registerKeyboardShortcut(48+parseInt(n),!1,!1,!1,!1,function(){RL.selectRoom(t)})}()}},{key:"isScrollable",value:function(){return this.get(0).scrollHeight>this.height()}},{key:"triggerDefaultAction",value:function(e){var t=$("._message:hover").find("[data-cwui-ab-type='"+e+"']");this.isDomExists(t)&&t.trigger("click")}},{key:"triggerMoreAction",value:function(){var e=$("._message:hover").find("._cwABMoreTip");if(this.isDomExists(e)){e.trigger("click");var t=$("._cwABMoreListBox").find('[data-cwui-ab-type="action"]');this.isDomExists(t)&&t.trigger("click")}}},{key:"selectRoom",value:function(e){RL.selectRoom(e)}},{key:"isDomExists",value:function(e){return e.length>0}},{key:"getHoverMessageId",value:function(){return $("._message:hover").data("mid")}},{key:"getPivotMessage",value:function(){return this.getHoverMessageId()||$("#_timeLine ._messageSelected").data("mid")}},{key:"getMessagePosition",value:function(e){for(var t=RM.timeline.chat_list,n=t.length-1;n>=0;n--)if(t[n].id==e)return n;return-1}},{key:"goToBottom",value:function(){this.goToMessageInRoom(RM.timeline.getLastChatId())}},{key:"goToPreviousMention",value:function(){for(var e=this.getPivotMessage(),t=this.getMessagePosition(e),n=RM.timeline.chat_list,o=t-1;o>=0;o--)if(this.isMentionMessage(n[o]))return this.goToMessageInRoom(n[o].id),!0;if(!RM.timeline.has_old&&0==n.length)return!1;RM.timeline.loadOld()}},{key:"goToNexMention",value:function(){for(var e=this.getPivotMessage(),t=this.getMessagePosition(e),n=RM.timeline.chat_list,o=t+1;o>0&&o<n.length;o++)if(this.isMentionMessage(n[o]))return this.goToMessageInRoom(n[o].id),!0;return!1}},{key:"goToMessageInRoom",value:function(e){RL.selectRoom(RM.id,e,{smoothScroll:!0})}},{key:"isMentionMessage",value:function(e){return[new RegExp("\\[.* aid="+AC.myid+" .*\\]"),new RegExp("\\[To:"+AC.myid+"\\]"),new RegExp("\\[toall\\]")].some(function(t){return t.test(e.msg)})}},{key:"replyMessage",value:function(e){var t=RM.timeline.chat_id2chat_dat[e];if(t){$("#_chatText").focus();var n=ST.data.private_nickname&&!RM.isInternal()?AC.getDefaultNickName(t.aid):AC.getNickName(t.aid);CS.view.setChatText("["+L.chatsend_reply+" aid="+t.aid+" to="+RM.id+"-"+e+"] "+n+"\n",!0)}}},{key:"nextUnreadRoom",value:function(e){for(var t=RM.id,n=RL.getSortedRoomList(),o=RL.rooms,i=0;i<n.length;i++)if(n[i]&&n[i]!==t){var r=o[n[i]];if(e?r.getMentionNum():r.getUnreadNum())return RL.selectRoom(r.id)}}},{key:"nextRoom",value:function(e){for(var t=void 0,n=RM.id,o=RL.getSortedRoomList(),i=0;i<o.length;i++){if(o[i]===n)if(e){if(t)return RL.selectRoom(t)}else if(o[i+1])return RL.selectRoom(o[i+1]);t=o[i]}}},{key:"firstRoom",value:function(e){var t=RL.getSortedRoomList(),n=e?RL.getStickyRoomNum():0;return RL.selectRoom(t[n])}}]),e}());e.exports=T},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(5),r=n(0),a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.to_all_status=!0}return o(e,[{key:"isActive",value:function(){return this.to_all_status}},{key:"updateGetContactPanelView",value:function(){AC.view.getContactPanelOld=AC.view.getContactPanel,AC.view.getContactPanel=function(e,t){var n=AC.view.getContactPanelOld(e,t);if(e==i.myId())return n;var o=$("<div></div>"),r="ja"==LANGUAGE?"同じグループチャットを探す":"Search for the same Group Chat";return $(o).html(n),$(".contactPanel__footerButtonContainer",o).first().append('<div class="button searchSameRooms _showDescription" aria-label="'+r+'" style="margin: 0 10px" data-uid="'+e+'"><span class="icoFontAdminInfoMenu icoSizeLarge"></span></div>'),$(o).html()},$(document).on("click",".searchSameRooms",function(e){var t=$(e.currentTarget).data("uid"),n=i.getUserName(t),o=i.searchRoomsByPerson(t),r="";o.forEach(function(e){r+='<a href="https://www.chatwork.com/#!rid'+e.id+'"><div class="searchResultTitle _messageSearchChatGroup sameRoomInfo" data-rid="'+e.id+'"><div>'+e.getIcon()+" "+e.getName()+"</div></div></a>"});var a="";r&&(a='<div class="">Remove <strong>'+n+'</strong> from the Rooms where you are an Administrator!<br>Please be careful!<br><div id="_removeSameRoomsBtn" role="button" tabindex="2" class="button btnDanger _cwBN" data-uid="'+t+'">Delete</div></div>'),r='<div class="searchResultListBox"><div class="searchResultTitle _messageSearchChatGroup"><strong><span id="_sameRoomsNumber">'+o.length+"</span> room(s) found!</strong></div>"+r+a+"</div>",CW.view.alert(r,null,!0)}),$(document).on("click","#_removeSameRoomsBtn",function(e){var t=$(e.currentTarget).data("uid"),n=i.getUserName(t);CW.confirm("Are you sure to delete "+n+" from the rooms that you are an Administrator?",function(){var e="";i.searchRoomsByPerson(t).forEach(function(n){if(i.removeMemberFromRoom(t,n.id)){$('.sameRoomInfo[data-rid="'+n.id+'"]').hide();var o=$("#_sameRoomsNumber");o.html(o.html()-1),e+='<a href="https://www.chatwork.com/#!rid'+n.id+'"><div class="searchResultTitle _messageSearchChatGroup sameRoomInfo" data-rid="'+n.id+'"><div>'+n.getIcon()+" "+n.getName()+"</div></div></a>"}}),e&&(e='<div class="searchResultListBox"><div class="searchResultTitle _messageSearchChatGroup"><strong>'+n+"</strong> has been removed from the following room(s)!</div>"+e+"</div>",CW.view.alert(e,null,!0))})})}},{key:"updateChatSendView",value:function(){CS.view.chatTextKeyUpOld=CS.view.chatTextKeyUp,CS.view.chatTextKeyUp=function(e){var t=e.keyCode,n=$("#_chatText");return function(){if(13===t&&13===press_key){var e=n.val(),o=n.prop("selectionStart"),i=n.prop("selectionEnd");o===i&&(i=e.substr(0,o),i=$.support.isWindowsFirefox?i.replace(/(^|\n)``` *\r?\n([\s\S]+?)\r?\n```$/,"$1[code]\n$2\n[/code]"):i.replace(/(^|\n)``` *\r?\n([\s\S]+?)\r?\n```\n$/,"$1[code]\n$2\n[/code]\n"),i=$.support.isWindowsFirefox?i.replace(/(^|\n)``t *\r?\n([\s\S]+?)\r?\n```$/,"$1[title]$2[/title]"):i.replace(/(^|\n)``t *\r?\n([\s\S]+?)\r?\n```\n$/,"$1[title]$2[/title]"),i=$.support.isWindowsFirefox?i.replace(/(^|\n)``i *\r?\n([\s\S]+?)\r?\n```$/,"$1[info]$2[/info]"):i.replace(/(^|\n)``i *\r?\n([\s\S]+?)\r?\n```\n$/,"$1[info]$2[/info]\n"),e=e.substr(o),n.val(i+e),n.prop("selectionStart",i.length),n.prop("selectionEnd",i.length))}}(),CS.view.chatTextKeyUpOld(e)}}},{key:"updateChatworkView",value:function(){TimeLineView.prototype.getMessagePanelOld=TimeLineView.prototype.getMessagePanel,TimeLineView.prototype.getMessagePanel=function(e,t){0===e.msg.indexOf(r.TO_ALL_MARK)&&(e.mn=!0);var n=this.getMessagePanelOld(e,t);return!0===e.mn&&(n=n.replace('class="_message timelineMessage"','class="_message timelineMessage timelineMessage--mention"')),console.log(e,t,n),n}}}]),e}());e.exports=a},function(e,t){var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"setUp",value:function(){var e=null;if(""!==localStorage.CHATPP_DISABLE_NOTIFY_ROOM&&"undefined"!==localStorage.CHATPP_DISABLE_NOTIFY_ROOM&&localStorage.CHATPP_DISABLE_NOTIFY_ROOM&&(e=JSON.parse(localStorage.CHATPP_DISABLE_NOTIFY_ROOM)),e){CW.popupOld=CW.popup;window.navigator.userAgent.toLowerCase().indexOf("chrome");CW.popup=function(t,n,o,i){-1==e.indexOf(i.toString())&&CW.popupOld(t,n,o,i)}}}}]),e}();e.exports=o},function(e,t){var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"setUp",value:function(){this.registerRegex()}},{key:"registerRegex",value:function(){CW.reg_cmp.push({key:/TO ALL &gt;&gt;&gt;/g,rep:'<span class="chatTimeLineTo">TO ALL</span>',reptxt:"TO ALL",special:!0})}}]),e}());e.exports=o},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(1),r=n(0),a=n(5),s=20,c=["\n","!","$","%","^","&","*","(",")","-","+","=","[","]","{","}",";",":",",","/","`","'",'"'],l="._",u=".",h="_",d="_cc_",m=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.status=i.getStatus("mention"),this.start=/@/gi,this.is_colon=!1,this.is_displayed=!1,this.is_inserted=!1,this.is_navigated=!1,this.is_outbound_of_list=!1,this.actived_atmark_index=0,this.current_index=0,this.selected_index=0,this.current_RM=null,this.member_objects=[],this.insert_mode="normal",this.insert_type="one",this.selected_group_name="",this.fuse=null,this.cached_enter_action=ST.data.enter_action,this.options={keys:["aid2name"],maxPatternLength:s},this.suggestion_messages={one:{ja:"検索結果はありません",en:"No Matching Results"},all:{ja:"すべてを選択します",en:"Select All Members"},group:{ja:"空のグループ",en:"Empty Group"}},this.random_user_messages={ja:"メンバーをランダムする",en:"Random a member"},this.no_admin_messages={ja:"アドミンが存在しません",en:"There is no Admin in this Room"},this.group_mention=[],localStorage[r.LOCAL_STORAGE_GROUP_MENTION]&&(this.group_mention=JSON.parse(localStorage[r.LOCAL_STORAGE_GROUP_MENTION])),this.group_mention.push({group_name:"random",group_members:""}),this.group_mention.push({group_name:"admin",group_members:a.getRoomAdmins().join(",")}),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})}),$("#_roomListArea").click(function(){return t.hideSuggestionBox()}),$("#_headerSearch").click(function(){return t.hideSuggestionBox()}),$(document).keyup(function(e){t.status&&27==e.which&&t.hideSuggestionBox()})}return o(e,[{key:"setUp",value:function(){var e=this;this.status&&!this.isTagAdded()&&(this.chat_text_jquery=$("#_chatText"),this.chat_text_element=document.getElementById("_chatText"),$("<div id='suggestion-container' class='toSelectorTooltip tooltipListWidth tooltip tooltip--white' role='tooltip'></div>").insertAfter("#_chatText"),this.hideSuggestionBox(),$("#_sendEnterActionArea").click(function(){e.cached_enter_action=ST.data.enter_action}),this.chat_text_jquery.click(function(){return e.hideSuggestionBox()}),this.chat_text_jquery.keydown(function(t){e.status&&(38!=t.which&&40!=t.which&&9!=t.which&&13!=t.which||!e.is_displayed?(e.current_index=0,e.is_navigated=!1):(e.is_navigated=!0,e.holdCaretPosition(t)),e.getNearestColonIndex()?e.is_colon=!0:e.is_colon=!1,9!=t.which&&13!=t.which||("all"!=e.insert_type&&"group"!=e.insert_type||!e.is_displayed?$(".suggested-name").first().length?(e.is_navigated?$(".suggested-name").eq(e.selected_index).click():$(".suggested-name").first().click(),"send"==e.cached_enter_action&&(ST.data.enter_action="br"),t.preventDefault()):e.hideSuggestionBox():(e.setSuggestedChatText(e.getTypedText(),null,null),"send"==e.cached_enter_action&&(ST.data.enter_action="br"),t.preventDefault())))}),this.chat_text_jquery.keyup(function(t){if(e.status&&9!=t.which&&13!=t.which){if(38!=t.which&&40!=t.which||!e.is_displayed?e.is_navigated=!1:(e.is_navigated=!0,e.holdCaretPosition(t)),e.current_RM!=RM.id&&(e.member_objects=e.buildMemberListData(!1),e.updateAdminGroupData(),e.fuse=new Fuse(e.member_objects,e.options),e.current_RM=RM.id),e.findAtmark()){if(e.is_displayed&&-1!=e.getNearestAtmarkIndex()&&e.getNearestAtmarkIndex()!=e.actived_atmark_index&&e.hideSuggestionBox(),!e.is_displayed){if(!e.isTriggerKeyCode(t.which))return;-1!=e.getNearestAtmarkIndex()&&(e.actived_atmark_index=e.getNearestAtmarkIndex()),e.setSuggestionBoxPosition(),e.showSuggestionBox(e.buildList(e.filterDisplayResults(e.member_objects))),e.is_displayed=!0}var n=e.getTypedText();if(n.length){"#"==n.charAt(1)&&("contact"!=e.insert_type&&(e.member_objects=e.buildMemberListData(!0),e.fuse=new Fuse(e.member_objects,e.options),e.insert_type="contact"),n=n.substring(1));var o=e.getRawResultsAndSetMode(n.substring(1));38==t.which&&(e.current_index-=1),40==t.which&&(e.current_index+=1);var i=e.filterDisplayResults(o);38==t.which&&e.is_outbound_of_list&&(e.selected_index-=1,e.selected_index<0&&(e.selected_index=0)),40==t.which&&e.current_index>o.length-i.length&&(e.selected_index+=1,e.selected_index>=Math.min(3,i.length)&&(e.selected_index=Math.min(3,i.length)-1)),e.showSuggestionBox(e.buildList(i))}27==t.which&&(e.hideSuggestionBox(),e.holdCaretPosition(t))}else e.hideSuggestionBox();return!0}}),this.addTagButton(),this.ccMention())}},{key:"getNearestAtmarkIndex",value:function(){var e=this.chat_text_jquery.val();if(!e.match(this.start))return-1;var t=this.doGetCaretPosition(this.chat_text_element),n=e.indexOf("@"),o=-1;do{if(n>=t)break;o=n,n=e.indexOf("@",n+1)}while(-1!=n);return o}},{key:"getNearestColonIndex",value:function(){var e=this.chat_text_jquery.val();if(!e.match(this.start))return-1;var t=this.doGetCaretPosition(this.chat_text_element),n=e.indexOf("::"),o=-1;do{if(n>=t)break;o=n,n=e.indexOf("::",n+1)}while(-1!=n);return o}},{key:"findAtmark",value:function(){var e=this.chat_text_jquery.val(),t=this.getNearestAtmarkIndex();if(0!=t&&" "!=e.charAt(t-1)&&"\n"!=e.charAt(t-1))return!1;if(this.getTypedText().length>=s||0==this.getTypedText().length)return!1;if(-1!=t){var n=this.getTypedText().match(/ /gi);if(n&&n.length>2)return!1;for(var o=0;o<c.length;o++)if(-1!=this.getTypedText().indexOf(c[o]))return!1;return!0}return!1}},{key:"getTypedText",value:function(){var e=this.chat_text_jquery.val(),t=this.getNearestAtmarkIndex();if(-1==t)return"";var n=this.doGetCaretPosition(this.chat_text_element),o=e.substr(t,n-t);return o||""}},{key:"setSuggestionBoxPosition",value:function(){var e=this.chat_text_element.getBoundingClientRect(),t=this.doGetCaretPosition(this.chat_text_element);this.setCaretPosition(this.chat_text_element,this.actived_atmark_index+1);var n=Measurement.caretPos(this.chat_text_jquery);n.top-=e.top,n.left-=e.left,e.width-n.left<236&&(n.left-=236),e.height-n.top<90?(n.top<108&&$("#_chatTextArea").css({"overflow-y":"visible","z-index":2}),n.top-=118):n.top+=parseInt(this.chat_text_jquery.css("font-size"))+5,$("#suggestion-container").parent().css({position:"relative"}),$("#suggestion-container").css({top:n.top,left:n.left,position:"absolute"}),this.setCaretPosition(this.chat_text_element,t)}},{key:"showSuggestionBox",value:function(e){var t=this;this.is_inserted=!1,$("#suggestion-container").html(e).show(),$("#suggestion-container").css("visibility","visible"),this.is_navigated?$(".suggested-name").eq(this.selected_index).css("background-color","#D8F0F9"):$(".suggested-name").first().css("background-color","#D8F0F9"),$(".suggested-name").click(function(e){if(!t.is_inserted){t.is_inserted=!0;var n=$(e.currentTarget);n.css("background-color","#D8F0F9"),t.setSuggestedChatText(t.getTypedText(),n.text(),n.data("cwui-lt-value"))}}),$(".suggested-name").mouseover(function(e){$(e.currentTarget).css("background-color","white"),$("#suggestion-container>ul li:first-child").css("background-color","#D8F0F9")})}},{key:"hideSuggestionBox",value:function(e){$("#suggestion-container").html(e).hide(),$("#suggestion-container").css("visibility","hidden"),this.cleanUp()}},{key:"cleanUp",value:function(){this.is_displayed=!1,this.is_navigated=!1,this.current_index=0,this.selected_index=0,this.actived_atmark_index=-1,this.insert_mode="normal","contact"==this.insert_type&&(this.member_objects=this.buildMemberListData(!1),this.fuse=new Fuse(this.member_objects,this.options)),"group"==this.insert_type&&(this.selected_group_name=""),this.insert_type="one",$("#suggestion-container").html(""),this.is_colon||$("#_chatTextArea").css({"overflow-y":"scroll","z-index":0}),this.cached_enter_action!=ST.data.enter_action&&"send"==this.cached_enter_action&&(ST.data.enter_action=this.cached_enter_action)}},{key:"doGetCaretPosition",value:function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}},{key:"setCaretPosition",value:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}},{key:"merge",value:function(){for(var e=arguments,t={},n=[],o=0;o<e.length;o++)for(var i=0;i<e[o].length;i++)!0!==t[e[o][i]]&&(n[n.length]=e[o][i],t[e[o][i]]=!0);return n}},{key:"filterDisplayResults",value:function(e){return this.is_outbound_of_list=!1,this.is_navigated?(this.current_index<0&&(this.current_index=0),this.current_index>=e.length&&(this.current_index=e.length-1),e.length<=3?(this.is_outbound_of_list=!0,e):this.current_index>=e.length-3?(this.is_outbound_of_list=!0,e.slice(-3)):e.slice(this.current_index,this.current_index+3)):e.slice(0,3)}},{key:"getRawResultsAndSetType",value:function(e){if("contact"!=this.insert_type){for(var t=0;t<this.group_mention.length;t++)if(e==this.group_mention[t].group_name)return this.insert_type="group",this.selected_group_name=this.group_mention[t].group_name,[];if("me"==e)return this.insert_type="me",[this.getMemberObject(AC.myid)];if("all"==e)return this.insert_type="all",[];if("toall"==e)return this.insert_type="toall",[];this.insert_type="one"}return e?this.fuse.search(e):this.member_objects}},{key:"getRawResultsAndSetMode",value:function(e){return e.slice(0,2)==l?(this.insert_mode="picon",this.getRawResultsAndSetType(e.substring(2))):e.slice(0,1)==u?(this.insert_mode="name",this.getRawResultsAndSetType(e.substring(1))):e.slice(0,4)==d?(this.insert_mode="CC",this.getRawResultsAndSetType(e.substring(4))):e.slice(0,1)==h?(this.insert_mode="to",this.getRawResultsAndSetType(e.substring(1))):(this.insert_mode="normal",this.getRawResultsAndSetType(e))}},{key:"isTriggerKeyCode",value:function(e){return-1==[37,38,39,40].indexOf(e)}},{key:"holdCaretPosition",value:function(e){e.preventDefault(),this.chat_text_jquery.focus();var t=this.doGetCaretPosition(this.chat_text_element);this.setCaretPosition(this.chat_text_element,t)}},{key:"getReplaceText",value:function(e,t,n,o){if(!o)return null;var i="";switch(this.insert_type){case"me":case"one":case"contact":i=e.format(n,t);break;case"group":case"all":for(var r=0;r<o.length;r++)i+=e.format(o[r].value,o[r].aid2name);break;case"toall":i="to"===this.insert_mode?"TO ALL >>> \n":"[toall]\n"}return i}},{key:"setSuggestedChatText",value:function(e,t,n){var o=this.chat_text_jquery.val(),i=this.doGetCaretPosition(this.chat_text_element)-e.length,r="",a=this.member_objects;switch("group"==this.insert_type&&(a=this.buildGroupMemberListData(this.selected_group_name)),this.insert_mode){case"to":r=this.getReplaceText("[To:{0}] ",t,n,a);break;case"normal":r=this.getReplaceText("[To:{0}] {1}\n",t,n,a);break;case"picon":r=this.getReplaceText("[picon:{0}] ",t,n,a);break;case"name":r=this.getReplaceText("[picon:{0}] {1}\n",t,n,a);break;case"CC":r=this.getReplaceText("[CC][To:{0}] {1}\n",t,n,a)}var s=o.substring(0,i)+r+o.substring(i+e.length);this.chat_text_jquery.val(s),this.setCaretPosition(this.chat_text_element,i+r.length),this.hideSuggestionBox()}},{key:"setSuggestedChatTag",value:function(e){var t=this.chat_text_jquery.val(),n=this.chat_text_jquery[0].selectionStart,o=this.chat_text_jquery[0].selectionEnd,i=t.substring(n,o),r="["+e+"]"+i+"[/"+e+"]",a=t.substring(0,n)+r+t.substring(o,t.length);this.chat_text_jquery.val(a),this.setCaretPosition(this.chat_text_element,n+2+e.length+i.length),this.hideSuggestionBox()}},{key:"buildList",value:function(e){switch(this.insert_type){case"me":case"one":case"contact":if(e.length){for(var t="<ul>",n=0;n<e.length;n++)t+='<li class="suggested-name tooltipList__item" role="listitem" data-cwui-lt-value="'+e[n].value+'">'+(e[n].avatar+e[n].label)+"</li>";return t+="</ul>"}return'<ul><li class="suggested-name tooltipList__item" role="listitem">'+this.suggestion_messages.one[LANGUAGE]+"</li></ul>";case"group":if("random"===this.selected_group_name)return'<ul><li class="suggested-name tooltipList__item" role="listitem">'+this.random_user_messages[LANGUAGE]+"</li></ul>";if((e=this.buildGroupMemberListData(this.selected_group_name)).length){for(var o="<ul><li class='suggested-name tooltipList__item' role='listitem'>",i=0;i<e.length;i++){if(6==i){o+="<span>+"+(e.length-6)+"</span>";break}o+=e[i].avatar}return o+="</li></ul>"}return'<ul><li class="suggested-name tooltipList__item" role="listitem">'+("admin"===this.selected_group_name?this.no_admin_messages[LANGUAGE]:this.suggestion_messages[this.insert_type][LANGUAGE])+"</li></ul>";case"all":return'<ul><li class="suggested-name tooltipList__item" role="listitem">'+this.suggestion_messages[this.insert_type][LANGUAGE]+"</li></ul>";case"toall":return'<ul><li class="suggested-name tooltipList__item" role="listitem">To All</li></ul>'}}},{key:"buildMemberListData",value:function(e){if(!RM)return[];var t=RM.getSortedMemberList(),n=[];e&&(t=this.merge(t,AC.contact_list));for(var o=t.length,i=0;i<o;i++){var r=t[i];r!=AC.myid&&n.push(this.getMemberObject(r))}return n}},{key:"updateAdminGroupData",value:function(){this.group_mention.forEach(function(e){"admin"===e.group_name&&(e.group_members=a.getRoomAdmins().join(","))})}},{key:"getMemberObject",value:function(e){var t=CW.is_business&&ST.data.private_nickname&&!RM.isInternal()?AC.getDefaultNickName(e):AC.getNickName(e);return{value:e,avatar:CW.getAvatarPanel(e,{clicktip:!1,size:"small"}),label:'<p class="autotrim">'+i.htmlEncode(t)+"</p>",aid2name:i.htmlEncode(t)}}},{key:"buildGroupMemberListData",value:function(e){if("random"===e){var t=a.getRandomMemberInRoom();return[this.getMemberObject(t)]}for(var n=0;n<this.group_mention.length;n++)if(this.group_mention[n].group_name==e){var o=this.group_mention[n].group_members;if(!o)return[];o=o.split(",");for(var i=[],r=0;r<o.length;r++)i.push(this.getMemberObject(o[r].trim()));return i}return[]}},{key:"ccMention",value:function(){CW.reg_cmp.push({key:/\[CC\]<span class=\"chatTimeLineTo\">TO<\/span>/g,rep:'<span class="chatTimeLineTo">CC</span>',reptxt:"[CC]",special:!0})}},{key:"isTagAdded",value:function(){return $("._chatppbutton").length>0}},{key:"addTagButton",value:function(){var e=this;$("#_tag").length>0||this.isTagAdded()||($("#_chatSendTool").append($("<li>",{id:"infoTag",class:"_showDescription _chatppbutton",attr:{role:"button"},css:{display:"inline-block","margin-left":5}}).append($("<span>",{class:"chatInput__emoticon chatInput__iconContainer"}).append("<strong>[info]</strong>"))),$("#_chatSendTool").append($("<li>",{id:"titleTag",class:"_showDescription _chatppbutton",attr:{role:"button"},css:{display:"inline-block"}}).append($("<span>",{class:"chatInput__emoticon chatInput__iconContainer"}).append("<strong>[title]</strong>"))),$("#_chatSendTool").append($("<li>",{id:"codeTag",class:"_showDescription _chatppbutton",attr:{role:"button"},css:{display:"inline-block"}}).append($("<span>",{class:"chatInput__emoticon chatInput__iconContainer"}).append("<strong>[code]</strong>"))),$("#infoTag").click(function(){e.setSuggestedChatTag("info")}),$("#titleTag").click(function(){e.setSuggestedChatTag("title")}),$("#codeTag").click(function(){e.setSuggestedChatTag("code")}))}}]),e}());e.exports=m},function(e,t,n){var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(1),r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"setUp",value:function(){var e=this;$("#_roomInfo").length>0||($("#_chatSendTool").append($("<li>",{id:"_roomInfo",class:"_showDescription chatInput__element",css:{display:"inline-block"}}).append($("<span>",{class:"icoFontAdminInfoMenu icoSizeLarge"}))),$("body").append($("<div>",{id:"_roomInfoList",class:"roomInfo emoticonTooltip toolTip tooltip--white mainContetTooltip",attr:{role:"tooltip"}}).append($("<div>",{class:"_cwTTTriangle toolTipTriangle toolTipTriangleWhiteBottom"}),$("<span>",{id:"_roomInfoText"}).append($("<div>",{id:"_roomInfoTextTotalMembers",class:"tooltipFooter"}),$("<div>",{id:"_roomInfoTextTotalMessages",class:"tooltipFooter"}),$("<div>",{id:"_roomInfoTextTotalFiles",class:"tooltipFooter"}),$("<div>",{id:"_roomInfoTextTotalTasks",class:"tooltipFooter"}),$("<div>",{id:"_roomInfoTextMyTasks",class:"tooltipFooter"})))),$("#_roomInfo").click(function(t){e.prepareRoomInfo();var n=RM.getIcon()+" "+i.htmlEncode(RM.getName());$("#_roomInfoList").cwListTip({selectOptionArea:"<b>"+n+"</b> Information",fixHeight:!1,search:!1}).open($(t.currentTarget))}))}},{key:"prepareRoomInfo",value:function(){var e="<b>Total Members</b>: "+RM.getSortedMemberList().length;$("#_roomInfoTextTotalMembers").html(e);var t="<b>Total Messages</b>: "+RM.chat_num;$("#_roomInfoTextTotalMessages").html(t);var n="<b>Total Tasks</b>: "+RM.task_num;$("#_roomInfoTextTotalTasks").html(n);var o="<b>My Tasks</b>: "+RM.mytask_num;$("#_roomInfoTextMyTasks").html(o);var i="<b>Total Files</b>: "+RM.file_num;$("#_roomInfoTextTotalFiles").html(i)}}]),e}());e.exports=r},function(e,t){var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"setUp",value:function(){var e=this;$("#_chatppSponsored").length>0||($("#_chatSendTool").append($("<li>",{id:"_chatppSponsored",class:"_showDescription",css:{display:"inline-block"},attr:{role:"button","aria-label":"Chat Plus Plus Information"}}).append($("<span>",{id:"chatppPreLoad",class:"icoSizeSmall"})).append(this.getAdvertisementText())),setInterval(function(){e.changeRandomAdvertisement()},3e4))}},{key:"changeRandomAdvertisement",value:function(){var e=this.getAdvertisementText();$("#chatppAdvertisement").html(e)}},{key:"getAdvertisementText",value:function(){if(void 0!==localStorage.chatpp_advertisement&&localStorage.chatpp_advertisement){var e=JSON.parse(localStorage.chatpp_advertisement);if(e.length>0)return e[Math.floor(Math.random()*e.length)]}return"Advertisement Here!"}}]),e}());e.exports=o}]);