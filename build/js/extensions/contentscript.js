!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=15)}([function(t,e){t.exports={LOCAL_STORAGE_DATA_KEY:"YACEP_EMO_DATA",LOCAL_STORAGE_INFO_KEY:"YACEP_EMO_INFO",LOCAL_STORAGE_GROUP_MENTION:"CHATPP_GROUP_MENTION",LOCAL_STORAGE_ROOM_SHORTCUT:"CHATPP_ROOM_SHORTCUT",LOCAL_STORAGE_DISABLE_NOTIFY_ROOM:"CHATPP_DISABLE_NOTIFY_ROOM",CHROME_LOCAL_KEY:"CHATPP_CHROME_LOCAL_DATA",CHROME_SYNC_KEY:"CHATPP_CHROME_SYNC_DATA",CHROME_SYNC_GROUP_KEY:"CHATPP_CHROME_SYNC_GROUP",CHROME_SYNC_ROOM_KEY:"CHATPP_CHROME_SYNC_ROOM",CHROME_SYNC_DISABLE_NOTIFY_ROOM_KEY:"CHATPP_CHROME_SYNC_DISABLE_NOTIFY_ROOM",DEFAULT_DATA_URL:"https://dl.dropboxusercontent.com/s/lmxis68cfh4v1ho/default.json?dl=1",ADVERTISEMENT_URL:"https://dl.dropboxusercontent.com/s/jsmceot0pqi8lpk/chatppad.json?dl=1",VERSION_CHROME:"VERSION_CHROME",VERSION_FIREFOX:"VERSION_FIREFOX",VERSION_NAME_DEV:"dev",VERSION_NAME_RELEASE:"final",DEFAULT_IMG_HOST:"https://chatpp.thangtd.com/",DELAY_TIME:6e3,FORCE_TURN_OFF_THUMBNAIL:1,ADVERTISEMENT_LOAD_TIMEOUT:18e5,TO_ALL_MARK:"TO ALL >>>"}},function(t,e,n){var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();var o=n(0),r=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.version=o.VERSION_CHROME,this.app_detail=this.getAppDetail(),this.official_emoticons_data={Default:{name:"Default",link:"https://dl.dropboxusercontent.com/s/lmxis68cfh4v1ho/default.json?dl=1",description:"The default Emoticons data of Chat++"},Vietnamese:{name:"Vietnamese",link:"https://dl.dropboxusercontent.com/s/2b085bilbno4ri1/vietnamese.json?dl=1",description:"Yet another data for people who want to use Vietnamese Emoticons"},Japanese:{name:"Japanese",link:"https://dl.dropboxusercontent.com/s/fdq05pwwtsccrn6/japanese.json?dl=1",description:"Yet another data for people who want to use Japanese Emoticons"},Skype:{name:"Skype",link:"https://dl.dropboxusercontent.com/s/8ew2mdh0v2vcad8/skype.json?dl=1",description:"Skype Original Emoticons"}}}return a(t,[{key:"isChromeVersion",value:function(){return this.version===o.VERSION_CHROME}},{key:"isFirefoxVersion",value:function(){return this.version===o.VERSION_FIREFOX}},{key:"isDevVersion",value:function(){var t=this.app_detail.name;return-1!==t.indexOf(o.VERSION_NAME_DEV,t.length-o.VERSION_NAME_DEV.length)}},{key:"checkDevVersionInternal",value:function(){return localStorage.chatpp_version_name===o.VERSION_NAME_DEV}},{key:"getStorage",value:function(t){return!t&&this.isChromeVersion()?chrome.storage.sync:chrome.storage.local}},{key:"sync",value:function(t,e,n){var a={};a[t]=e,this.getStorage().set(a,function(){n&&n()})}},{key:"getEmoticonDataUrl",value:function(t,e){return t&&this.official_emoticons_data[t]&&(e=this.official_emoticons_data[t].link),e?e.replace("http://i.imgur.com/","https://i.imgur.com/"):null}},{key:"getObjectLength",value:function(t){return Object.keys(t).length}},{key:"htmlEncode",value:function(t){return $("<div/>").text(t).html()}},{key:"getEmoUrl",value:function(t){var e=o.DEFAULT_IMG_HOST+"img/emoticons/"+t;return 0!=t.indexOf("https://")&&0!=t.indexOf("http://")||(e=t),this.htmlEncode(e)}},{key:"parseRoomId",value:function(t){var e=t.match(/\d+/g);if(!e||0==e.length)return null;e=e[0];return/^[0-9]{6,10}$/g.test(e)?e:null}},{key:"reload",value:function(){location.reload()}},{key:"getAppDetail",value:function(){return chrome.app.getDetails()}},{key:"getAppVersion",value:function(){return this.app_detail.version}},{key:"getAppVersionName",value:function(){return this.isDevVersion()?o.VERSION_NAME_DEV:o.VERSION_NAME_RELEASE}},{key:"getAppFullName",value:function(){var t=this.getAppVersionName();return this.app_detail.short_name+" "+this.app_detail.version+" "+t}},{key:"openNewUrl",value:function(t){chrome.tabs.create({url:t})}},{key:"getExtensionPageUrl",value:function(t){return chrome.extension.getURL(t)}},{key:"openNewExtensionPageUrl",value:function(t){this.openNewUrl(this.getExtensionPageUrl(t))}},{key:"validateUrl",value:function(t){return/(https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t)}},{key:"validateDropboxUrl",value:function(t){if(!this.validateUrl(t))return!1;var e=!0,n=!1,a=void 0;try{for(var o,r=["https://dl.dropboxusercontent.com/","https://www.dropbox.com/"][Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;if(t.startsWith(i))return!0}}catch(t){n=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw a}}return!1}},{key:"isPage",value:function(t){return $("#page-name").data("page-name")===t}},{key:"setPageTitle",value:function(){$("#chatpp_name").html(this.getAppFullName())}},{key:"setStatus",value:function(t,e){-1===t.indexOf("_status")&&(t+="_status"),localStorage[t]=!!e}},{key:"getStatus",value:function(t){return-1===t.indexOf("_status")&&(t+="_status"),"true"===localStorage[t]||!0===localStorage[t]}},{key:"regexEscape",value:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}},{key:"generateEmoticonRegex",value:function(t,e){return e=e||this.htmlEncode(this.regexEscape(t)),new RegExp(e,"g")}},{key:"random",value:function(t){return t.length?t[Math.floor(Math.random()*t.length)]:null}},{key:"randomString",value:function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}}]),t}());t.exports=r},function(t,e,n){var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();var o=n(1),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=o.getStorage(e)}return a(t,[{key:"get",value:function(t,e){this.storage.get(t,function(n){n=n?n[t]:void 0,e(n)})}},{key:"set",value:function(t,e,n){var a={};a[t]=e,this.storage.set(a,function(){n&&n()})}},{key:"setData",value:function(t,e){this.storage.set(t,function(){e&&e()})}}]),t}();t.exports=r},function(t,e,n){var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();var o=n(2),r=n(0),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=new o(!0),this.key=r.CHROME_LOCAL_KEY}return a(t,[{key:"get",value:function(t){this.storage.get(this.key,t)}},{key:"set",value:function(t,e){this.set(this.key,t,e)}},{key:"setData",value:function(t,e){this.storage.setData(t,e)}}]),t}();t.exports=i},function(t,e,n){var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();var o=n(1),r=n(2),i=n(0),s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.data={},t.data_count=0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),a(e,[{key:"getDataCount",value:function(){return o.getObjectLength(this.data)}},{key:"setFeatureStatus",value:function(t){var e=["mention","shortcut","thumbnail","highlight","emoticon"];for(var n in e){var a=e[n]+"_status";this.data[a]=void 0===t[a]||t[a]}this.data.force_update_version=t.force_update_version}},{key:"pushData",value:function(t,e){var n=void 0!==e?e:t.priority;void 0===this.data[t.data_name]&&this.data_count++,this.data[t.data_name]={priority:n,data_name:t.data_name,data_url:t.data_url,data_changelog:t.data_changelog,data_version:t.data_version,date_sync:(new Date).toLocaleString()}}},{key:"removeData",value:function(t){void 0!==this.data[t]&&delete this.data[t]}},{key:"syncData",value:function(t){this.set(i.CHROME_SYNC_KEY,this.data,t)}}]),e}();t.exports=s},,,,,,,,,,,function(t,e,n){t.exports=n(16)},function(t,e,n){var a,o=n(0),r=n(1),i=n(2),s=n(4),u=n(3),c=new i,l=new s,_=[],f={},p={};function d(){var t;O(),function(){$("#_chatSendTool").append($("<li>",{id:"_chatppPreLoad",css:{display:"inline-block"}}).append($("<span>",{id:"chatppPreLoad"})));var t=$("#chatppPreLoad"),e=o.DELAY_TIME/1e3,n=setInterval(function(){--e<=0&&($("#_chatppPreLoad").remove(),window.clearInterval(n));var a="Chat++ will be loaded in about "+e+" second"+(e>1?"s":"");t.html(a)},1e3)}(),h("libraries/caretposition.js"),h("libraries/fuse.min.js"),h("libraries/highlight.min.js"),t="highlight.min.css",$("<link>",{rel:"stylesheet",type:"text/css",href:r.getExtensionPageUrl("css/"+t)}).appendTo("head"),setTimeout(function(){h("internals/all.js")},o.DELAY_TIME),setInterval(O,o.ADVERTISEMENT_LOAD_TIMEOUT)}function h(t){var e=document.createElement("script");e.src=r.getExtensionPageUrl("js/"+t),document.documentElement.appendChild(e)}function O(){chrome.runtime.sendMessage({contentScriptQuery:"fetchAdvertisementData"},function(t){$.isEmptyObject(t)||(localStorage.chatpp_advertisement=JSON.stringify(t))})}a=!0,c.get(o.CHROME_SYNC_KEY,function(t){if(!$.isEmptyObject(t))for(var e in t){var n=t[e],i=r.getEmoticonDataUrl(n.data_name,n.data_url);i&&(p[n.data_name]=i)}$.isEmptyObject(p)&&(p.Default=o.DEFAULT_DATA_URL),void 0===t&&(t={}),(!t.force_update_version||t.force_update_version<o.FORCE_TURN_OFF_THUMBNAIL)&&(t.force_update_version=o.FORCE_TURN_OFF_THUMBNAIL,t.thumbnail_status=!1,t.emoticon_status=!0),f=t,localStorage.force_update_version=t.force_update_version,["mention","shortcut","thumbnail","highlight","emoticon"].forEach(function(e){var n=e+"_status";t[n]=void 0===t[n]||t[n],r.setStatus(e,t[n])}),l.setFeatureStatus(t),0==t.emoticon_status?d():function(t,e){var n=0,a=r.getObjectLength(p),i=!1;localStorage.removeItem("failed_data"),$.each(p,function(t,r){var s=function(t){var e=!0,n=!1,a=void 0;try{for(var o,r=["https://dl.dropboxusercontent.com/","https://www.dropbox.com/"][Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;if(t.startsWith(i))return t.substring(i.length)}}catch(t){n=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw a}}return!1}(r);if(!s)return!1;chrome.runtime.sendMessage({contentScriptQuery:"fetchEmoticonsData",query:s,data_name:t},function(t){if(t.success){if(void 0!==t.data_version&&void 0!==t.emoticons){t.data_url=p[t.data_name];var r=f[t.data_name]&&f[t.data_name].priority?f[t.data_name].priority:0;l.pushData(t,r),function(t,e,n){for(var a=0;a<t.length;a++){var o=!1;t[a].priority=e,t[a].data_name=n;for(var r=0;r<_.length;r++)if(_[r].key===t[a].key){_[r].src!==t[a].src&&_[r].priority<t[a].priority&&(_[r]=t[a]),o=!0;break}o||_.push(t[a])}}(t.emoticons,r,t.data_name)}}else i=!0,delete f[t.data_name],function(t){var e=localStorage.failed_data?JSON.parse(localStorage.failed_data):[];e.push(t),localStorage.failed_data=JSON.stringify(e)}(t.data_name);if(++n===a){i||l.syncData();var s=new u;s.get(function(t){var n="";$.isEmptyObject(t)||(n=t.version_name),localStorage[o.LOCAL_STORAGE_DATA_KEY]=JSON.stringify(_),localStorage.chatpp_version_name=n,localStorage.emoticon_data_version=function(t){if(void 0!==t.data_name&&void 0!==t.data_version)return t.data_name+"_"+t.data_version;var e="";for(var n in t)void 0!==t[n].data_name&&(e+=t[n].data_name+"_"+t[n].data_version+"  ");return e}(f),void 0!==e&&e&&d()})}})})}(0,a)}),localStorage[o.LOCAL_STORAGE_GROUP_MENTION]=[],c.get(o.CHROME_SYNC_GROUP_KEY,function(t){$.isEmptyObject(t)||(localStorage[o.LOCAL_STORAGE_GROUP_MENTION]=JSON.stringify(t))}),localStorage[o.LOCAL_STORAGE_ROOM_SHORTCUT]=[],c.get(o.CHROME_SYNC_ROOM_KEY,function(t){$.isEmptyObject(t)||(localStorage[o.LOCAL_STORAGE_ROOM_SHORTCUT]=JSON.stringify(t))}),localStorage[o.LOCAL_STORAGE_DISABLE_NOTIFY_ROOM]=[],c.get(o.CHROME_SYNC_DISABLE_NOTIFY_ROOM_KEY,function(t){$.isEmptyObject(t)||(localStorage[o.LOCAL_STORAGE_DISABLE_NOTIFY_ROOM]=JSON.stringify(t))})}]);